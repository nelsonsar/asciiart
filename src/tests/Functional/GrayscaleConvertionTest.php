<?php

use AsciiArt\AsciiArt;

class GrayscaleConvertionTest extends PHPUnit_Framework_TestCase
{
    /**
     * @var string
     */
    private $imagesDirectory = null;

    const GRAYSCALE_PNG_IMAGE = 'image.png';

    public function setUp()
    {
        $this->imagesDirectory = getenv('FIXTURE_IMG_PATH');
        $this->imagesDirectory = realpath($this->imagesDirectory);
    }

    public function assertPreConditions()
    {
        $this->assertFileExists(
            $this->imagesDirectory,
            sprintf('Image directory should exist.', getenv('FIXTURE_IMG_PATH'))
        );
    }

    /**
     * @test
     */
    public function convert_png_image_to_asciiart()
    {
        $imagesDirectory = sprintf('%s/%s', $this->imagesDirectory, self::GRAYSCALE_PNG_IMAGE);
        $asciiArt = new AsciiArt;
        $expectedOutput = <<<EOT
+--------------------------------------------------+
|==================================================|
|==================================================|
|==================================================|
|=======================+==========================|
|===============+~............~+===================|
|============:.....~:++++++:~....~:================|
|==========:....+==============+~...:==============|
|========+~...+=================+:~..~+============|
|=======+~..+==+...~~~~~.~:~~~..:+=+..~+===========|
|======+~..:===~................:===+..~+==========|
|======:..:===+..................~===:..:==========|
|======~.~+==+....................:==+~.~==========|
|======~.~+==:....................+==+~.~==========|
|======~.~+==+~..................~+==+~.~==========|
|======:~.~+==:..................:===~..:==========|
|=======:..~+==+~.............~~+===~..:===========|
|========:...:=====:........:=====+~..:============|
|=========+~..~:+==+~......~+===:~...+=============|
|===========:~...~::........~:~....:===============|
|=============+:................:+=================|
|==================+:~~~~~~:++=====================|
|==================================================|
|==================================================|
|==================================================|
|==================================================|
+--------------------------------------------------+

EOT;

        $resultingOutput = $asciiArt->generateFrom($imagesDirectory);

        $this->assertEquals(
            $expectedOutput,
            $resultingOutput,
            'AsciiArt generation from a PNG image failed miserably.'
        );
    }
}
